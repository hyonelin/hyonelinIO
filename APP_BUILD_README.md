# AI活动追踪器 - macOS 应用程序

这是一个基于本地 Ollama 的离线屏幕活动分析和总结工具的 macOS 应用程序版本。

## 功能特点

- 🖥️ **图形化界面**：友好的 GUI 界面，支持实时配置
- 📸 **智能截图**：定时捕获屏幕内容进行分析
- 🤖 **AI 分析**：使用 Ollama 本地 AI 模型识别活动内容
- 📊 **活动统计**：生成详细的活动报告和统计信息
- 🛡️ **隐私保护**：完全本地运行，数据不上传云端
- ⚙️ **自定义配置**：通过设置页面调整所有参数

## 系统要求

- macOS 10.14 或更高版本
- Python 3.8 或更高版本
- 已安装并运行 Ollama
- 已下载 llava 模型：`ollama pull llava`

## 快速开始

### 方法1：使用预构建的应用程序

1. 下载 `AI活动追踪器-1.0.0.dmg` 文件
2. 双击打开 DMG 文件
3. 将应用程序拖拽到 Applications 文件夹
4. 在 Applications 文件夹中找到并启动应用程序

### 方法2：从源代码构建

1. 克隆或下载项目代码
2. 确保已安装 Python 3.8+
3. 运行构建脚本：
   ```bash
   ./build_macos.sh
   ```
4. 构建完成后，在 `dist` 目录找到应用程序

## 权限设置

首次运行应用程序时，需要授予以下权限：

1. **屏幕录制权限**：
   - 打开 `系统偏好设置` → `安全性与隐私` → `隐私`
   - 选择 `屏幕录制`
   - 添加并勾选 `AI活动追踪器`

2. **辅助功能权限**（可选）：
   - 在 `隐私` 选项中选择 `辅助功能`
   - 添加并勾选 `AI活动追踪器`

## 使用说明

### 基本操作

1. **启动应用**：打开应用程序后，点击 "开始追踪" 按钮
2. **查看日志**：实时查看活动识别日志
3. **配置设置**：点击 "设置" 按钮打开配置页面
4. **查看统计**：点击 "查看统计" 查看活动分析结果

### 设置页面

设置页面包含三个标签页：

#### 基本设置
- **截图间隔**：设置截图分析的时间间隔（默认1分钟）
- **保存截图**：是否保存截图文件到本地
- **截图质量**：设置截图的质量（1-100）
- **总结时间**：设置每日总结的生成时间

#### AI设置
- **Ollama URL**：Ollama 服务的地址（默认 http://localhost:11434）
- **模型名称**：使用的 AI 模型（推荐 llava:latest）
- **超时时间**：AI 分析的超时时间
- **分析提示词**：自定义 AI 分析的提示词
- **总结提示词**：自定义日总结的提示词

#### 存储设置
- **数据目录**：设置数据存储的根目录
- **数据库文件**：SQLite 数据库文件位置
- **截图目录**：截图文件保存目录

### 菜单功能

- **文件菜单**：
  - 设置：打开设置页面
  - 退出：关闭应用程序

- **查看菜单**：
  - 活动统计：查看活动分析统计
  - 今日总结：查看今日活动总结

- **帮助菜单**：
  - 关于：显示应用程序信息

## 构建详细说明

### 依赖安装

```bash
# 安装构建依赖
pip3 install -r requirements_build.txt

# 或手动安装
pip3 install py2app Pillow requests schedule pyyaml
```

### 构建过程

1. **清理构建目录**：删除之前的构建文件
2. **安装依赖**：自动安装所需的 Python 包
3. **构建应用**：使用 py2app 创建 .app 文件
4. **创建 DMG**：打包成 DMG 安装文件
5. **测试应用**：验证构建是否成功

### 构建配置

在 `setup.py` 中可以自定义：

- 应用程序名称和版本
- 图标文件（需要 .icns 格式）
- 包含的文件和模块
- 权限描述文本

## 故障排除

### 常见问题

1. **无法启动应用**：
   - 检查 Ollama 是否正在运行
   - 确认已下载 llava 模型
   - 检查屏幕录制权限是否已授予

2. **构建失败**：
   - 确保 Python 版本 >= 3.8
   - 检查是否安装了 py2app
   - 清理构建目录后重试

3. **AI 分析失败**：
   - 检查 Ollama 服务状态
   - 确认模型名称正确
   - 检查网络连接

### 日志文件

应用程序会生成以下日志文件：
- `activity_tracker.log`：主程序日志
- `data/activity_log.db`：活动数据库
- `data/screenshots/`：截图文件夹（如果启用）

## 技术架构

### 核心组件

- **GUI 界面**：使用 tkinter 构建的图形界面
- **截图模块**：使用 PIL.ImageGrab 进行屏幕捕获
- **AI 客户端**：与 Ollama 服务通信
- **数据库管理**：SQLite 数据存储
- **配置管理**：YAML 格式的配置文件

### 文件结构

```
AI活动追踪器.app/
├── Contents/
│   ├── Info.plist          # 应用信息
│   ├── MacOS/
│   │   └── AI活动追踪器    # 主执行文件
│   └── Resources/
│       ├── config.yaml     # 配置文件
│       ├── src/           # 源代码
│       └── lib/           # Python 库
```

## 许可证

本项目遵循 MIT 许可证。

## 更新日志

### v1.0.0 (2024-01-01)
- 初始版本
- 图形化界面
- 基本的活动追踪功能
- 设置页面
- DMG 打包支持

## 联系方式

如有问题或建议，请提交 Issue 或 Pull Request。

---

**注意**：本应用程序需要屏幕录制权限才能正常工作。请确保在系统偏好设置中授予相应权限。